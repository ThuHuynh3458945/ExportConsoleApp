using ExportConsoleApp.Models;
using System.Text;

namespace ExportConsoleApp.Services
{
    public class ExportWeeklyInvoiceForPrintifyService
    {
        public List<InvoicePrintifyModel> BuildData()
        {
            return new List<InvoicePrintifyModel>
            {
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                },
                new InvoicePrintifyModel
                {
                    Xid = "6479f509975e4a074002f7fb",
                    OrderId = "23755821",
                    Status = "Cancelled",
                    DtgSkuOrdered = "021-002-003",
                    DtgSku = "021-002-003",
                    ReceivedOnUtc = DateTime.UtcNow,
                    SortedOnUtc = null,
                    ShipQty = 1,
                    BlankCosts = (decimal)12.1,
                    PrintCosts = 5,
                    FrontPrint = 1,
                    BackPrint = 1,
                    SleevePrints = "",
                    InnerLabel = "",
                    OuterLabel = "",
                    HandlingCosts = 0,
                    Discount = 0,
                    TotalProductCosts = (decimal)17.1,
                    TaxRate = 0,
                    Tax = 0,
                    TotalProductCostWithTax = (decimal)17.1,
                    ShipState = "FL",
                    ShippingCountry = "US",
                    TrackingNumber = "9400136109679908024866",
                }
            };
        }

        public async Task<byte[]> ExportWeeklyInvoiceForPrintifyAsync(List<InvoicePrintifyModel> items)
        {
            #region Title
            var headerList = new List<string>
                {
                    "Printify Order #",
                    "Print Provider Order #",
                    "Status",
                    "Ordered SKU",
                    "Shipped SKU",
                    "Order Created",
                    "Ship Date",
                    "Item Quantity",
                    "Blank costs",
                    "Print costs",
                    "Front Print",
                    "Back Print",
                    "Sleeve Prints",
                    "Inner Label",
                    "Outer label",
                    "Handling costs",
                    "Discount",
                    "Total product costs",
                    "Tax rate",
                    "Tax",
                    "Total product cost with tax",
                    "Ship State",
                    "Country",
                    "Tracking Number"
                };

            var str = new StringBuilder();
            foreach (var header in headerList)
            {
                str.Append(header + ",");
            }
            str.Append("\r\n");
            #endregion Title

            #region Bind Data Detail

            foreach (var item in items)
            {
                str.Append(item.Xid + ",");
                str.Append(item.OrderId + ",");
                str.Append(item.Status + ",");
                str.Append(item.DtgSkuOrdered + ",");
                str.Append(item.DtgSku + ",");
                str.Append(item.ReceivedOnUtc.ToString("MM-dd-yyyy hh:mm:ss tt") + ",");
                str.Append((item.SortedOnUtc.HasValue ? item.SortedOnUtc.Value.ToString("MM-dd-yyyy hh:mm:ss tt") : "") + ",");
                str.Append(item.ShipQty + ",");
                str.Append(item.BlankCosts + ",");
                str.Append(item.PrintCosts + ",");
                if (item.FrontPrint > 0)
                {
                    str.Append(item.ShipQty + ",");
                }
                else
                {
                    str.Append(",");
                }

                if (item.BackPrint > 0)
                {
                    str.Append(item.ShipQty + ",");
                }
                else
                {
                    str.Append(",");
                }
                str.Append(item.SleevePrints + ",");
                str.Append(item.InnerLabel + ",");
                str.Append(item.OuterLabel + ",");
                str.Append(item.HandlingCosts + ",");
                str.Append(item.Discount + ",");
                str.Append(item.TotalProductCosts + ",");
                str.Append(item.TaxRate + ",");
                str.Append(item.Tax + ",");
                str.Append(item.TotalProductCostWithTax + ",");
                str.Append(item.ShipState + ",");
                str.Append(item.ShippingCountry + ",");
                str.Append("'" + item.TrackingNumber);
                str.Append("\r\n");
            }
            #endregion Bind Data Detail

            return Encoding.UTF8.GetBytes(str.ToString());
        }
    }
}
